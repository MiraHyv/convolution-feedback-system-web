(()=>{"use strict";function e(e){console.log(e)}class n{constructor(){const e=this.haeKonteksti();null!=e&&(this.luoShader("#version 300 es\nout vec2 uv;\n\nconst vec4 kulmat[4] = vec4[4](\n    vec4(-1, -1, 0, 1),\n    vec4( 1, -1, 0, 1),\n    vec4(-1,  1, 0, 1),\n    vec4( 1,  1, 0, 1)\n);\n\nconst vec2 kulmat_uv[4] = vec2[4](\n    vec2(0, 0),\n    vec2(1, 0),\n    vec2(0, 1),\n    vec2(1, 1)\n);\n\nvoid main() {\n    vec4 t = vec4(0.9, 0.9, 1, 1);\n    gl_Position = t * kulmat[gl_VertexID];\n    uv = kulmat_uv[gl_VertexID];\n}\n","#version 300 es\nprecision highp float;\nin vec2 uv;\nuniform sampler2D tekstuuri0;\nout vec4 color;\n\nvoid main(void) {\n    color = texture(tekstuuri0, uv);\n}\n"),this.fb=e.createFramebuffer())}haeKonteksti(){return document.querySelector("#piirtoalue").getContext("webgl2")}kaannaShader(n,t){const r=this.haeKonteksti(),a=r.createShader(n);return r.shaderSource(a,t),r.compileShader(a),r.getShaderParameter(a,r.COMPILE_STATUS)?a:(n==r.VERTEX_SHADER?e("Vertex shaderin kääntäminen epäonnistui:\n"):n==r.FRAGMENT_SHADER&&e("Fragment shaderin kääntäminen epäonnistui:\n"),e(r.getShaderInfoLog(a)),r.deleteShader(a),null)}luoShader(n,t){const r=this.haeKonteksti(),a=this.kaannaShader(r.VERTEX_SHADER,n);if(null==a)return;const i=this.kaannaShader(r.FRAGMENT_SHADER,t);if(null==i)return;const o=r.createProgram();return r.attachShader(o,a),r.attachShader(o,i),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)?(this.kaytaShaderia(o),o):(e("Shaderin linkitys epäonnistui:\n"),e(r.getProgramInfoLog(o)),null)}kaytaShaderia(e){this.haeKonteksti().useProgram(e)}piirra(){const e=this.haeKonteksti();e.drawArrays(e.TRIANGLE_STRIP,0,4)}generoiKuva(){const e=this.haeKonteksti(),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const t=e.RGBA,r=e.RGBA,a=e.UNSIGNED_BYTE,i=new Uint8Array(262144);let o=0;for(let e=0;e<256;e++)for(let n=0;n<256;n++)i[o]=n,i[o+1]=e,i[o+2]=(n+e)/2,i[o+3]=255,o+=4;return e.texImage2D(e.TEXTURE_2D,0,t,256,256,0,r,a,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),n}piirraKuva(e){const n=this.haeKonteksti();n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindTexture(n.TEXTURE_2D,e),n.viewport(0,0,640,512),this.piirra()}piirraKuvaan(e,n){const t=this.haeKonteksti();t.bindFramebuffer(t.FRAMEBUFFER,this.fb),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),t.bindTexture(t.TEXTURE_2D,e),t.viewport(0,0,256,256),this.piirra()}}const t="#version 300 es\nout vec2 uv;\n\nconst vec4 kulmat[4] = vec4[4](\n    vec4(-1, -1, 0, 1),\n    vec4( 1, -1, 0, 1),\n    vec4(-1,  1, 0, 1),\n    vec4( 1,  1, 0, 1)\n);\n\nconst vec2 kulmat_uv[4] = vec2[4](\n    vec2(0, 0),\n    vec2(1, 0),\n    vec2(0, 1),\n    vec2(1, 1)\n);\n\nvoid main() {\n    vec4 t = vec4(0.9, 0.9, 1, 1);\n    gl_Position = t * kulmat[gl_VertexID];\n    uv = kulmat_uv[gl_VertexID];\n}\n";!function(){const e=new n,r=e.generoiKuva(),a=e.generoiKuva(),i=e.luoShader(t,"#version 300 es\nprecision highp float;\nin vec2 uv;\nuniform sampler2D tekstuuri0;\nout vec4 color;\n\nvoid main(void) {\n    color = texture(tekstuuri0, uv);\n}\n"),o=e.luoShader(t,"#version 300 es\nprecision highp float;\nin vec2 uv;\nuniform sampler2D tekstuuri0;\nout vec4 color;\n\nvoid main(void) {\n    vec4 c = vec4(1, 1, 1, 1) - texture(tekstuuri0, uv);\n    c.a = 1.0;\n    color = c;\n}\n");e.kaytaShaderia(o),e.piirraKuvaan(a,r),e.kaytaShaderia(i),e.piirraKuva(r)}()})();